define(["backbone","view/content","view/popup","model/token-data","util/language-message","util/navigate","constant/item","constant/shop"],function(a,b,c,d,e,f,g,h){var i={CLOSE_PURCHASE_FAILURE:"close_purchase_failure"};return b.extend({popView:null,events:{"tap .pop-purchase-failure .btn-to-weapon-list":"locationList","tap .pop-purchase-failure .btn-equipment-off":"onTapBtnEquipmentOff","tap .pop-purchase-failure .btn-usual-close":"onTapBtnClosePurchaseFailure"},popForPurchaseFailure:function(a,b){var d=_.template(this.$el.find("#tpl-pop-purchase-failure").html()),f=new c({className:"pop-purchase-failure",flagBtnClose:1});this.popForPurchaseFailure=function(a){var c=this.extractedWeaponData(b);delete f.weaponIdList,a.used_weapon_ids?(f.options.flagBtnOk=0,f.weaponIdList=a.used_weapon_ids):a.locked_weapon_ids&&(f.options.flagBtnOk=1,f.options.btnOkClassName="btn-to-weapon-list",f.options.btnOkText=e.getMessage("pop_button_to_weapons")),f.options.title=c.master.name,f.options.body=d({data:a}),f.delegateEvents().render().popShow(),this.popView=f},this.popForPurchaseFailure(a,b)},extractedWeaponData:function(a){for(var b=1;b<=h.MAX_ITEM_FRAME;b++)if(+a["article"+b+"_kind"]===g.ITEM_KIND.WEAPON)return a["article"+b];return null},onTapBtnClosePurchaseFailure:function(){this.popView&&this.popView.popDelete(),this.trigger(i.CLOSE_PURCHASE_FAILURE)},onTapBtnEquipmentOff:function(){var a=this;this.trigger("xhrStart"),this.postEquipmentOff(this.popView.weaponIdList).done(function(){a.trigger("xhrEnd"),a.popCompleteEquipmentOff()}),this.popView&&this.popView.popDelete()},postEquipmentOff:function(a){var b=new(d.extend({urlRoot:Game.baseUri+"party/weapons_unequipment"}));return this.postEquipmentOff=function(a){return b.save({weapon_ids:a})},this.postEquipmentOff(a)},popCompleteEquipmentOff:function(){var a=this,b=new c({className:"pop-complete-equipment-off",title:e.getMessage("all_equipment_off_1"),body:e.getMessage("complete_equipment_off_1"),flagBtnClose:1});this.popCompleteEquipmentOff=function(){a.listenToOnce(b,"close",a.trigger.bind(a,i.CLOSE_PURCHASE_FAILURE)),b.delegateEvents().render().popShow()},this.popCompleteEquipmentOff()},locationList:function(){f.hash("list")}},{EVENT:i}).singleton()});